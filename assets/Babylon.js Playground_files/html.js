/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
"use strict";var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r};define("vs/languages/html/html",["require","exports","vs/editor/modes/modes","vs/editor/modes/modesExtensions","vs/editor/modes/supports","vs/platform/platform","vs/platform/services","vs/base/lib/winjs.base","vs/platform/thread/attribute","vs/editor/modes/autoIndentation/autoIndentation"],function(e,t,r,n,o,s,i,a,l,c){!function(e){e[e.Content=0]="Content",e[e.OpeningStartTag=1]="OpeningStartTag",e[e.OpeningEndTag=2]="OpeningEndTag",e[e.WithinDoctype=3]="WithinDoctype",e[e.WithinTag=4]="WithinTag",e[e.WithinComment=5]="WithinComment",e[e.WithinEmbeddedContent=6]="WithinEmbeddedContent",e[e.AttributeName=7]="AttributeName",e[e.AttributeValue=8]="AttributeValue"}(t.States||(t.States={}));var u=t.States,d=["area","base","basefont","br","col","frame","hr","img","input","isindex","link","meta","param"],h=["script","style"],p=new c.Brackets([],[{tokenType:"tag.html.tag-$1",openTrigger:">",open:/<(\w[\w\d]*)(\s+.*[^\/]>|\s*>)[^<]*$/i,closeComplete:"</$1>",closeTrigger:">",close:/<\/(\w[\w\d]*)\s*>$/i}],null,!0),m=function(e){function t(t,r,n,o,s,i,a){e.call(this,t),this.kind=r,this.lastTagName=n,this.lastAttributeName=o,this.embeddedContentType=s,this.attributeValueQuote=i,this.attributeValue=a}return __extends(t,e),t.escapeTagName=function(e){return"tag.html.tag-"+e.replace(/:/g,"-")},t.prototype.makeClone=function(){return new t(this.getMode(),this.kind,this.lastTagName,this.lastAttributeName,this.embeddedContentType,this.attributeValueQuote,this.attributeValue)},t.prototype.equals=function(r){return r instanceof t?e.prototype.equals.call(this,r)&&this.kind===r.kind&&this.lastTagName===r.lastTagName&&this.lastAttributeName===r.lastAttributeName&&this.embeddedContentType===r.embeddedContentType&&this.attributeValueQuote===r.attributeValueQuote&&this.attributeValue===r.attributeValue:!1},t.prototype.nextName=function(e){return e.advanceIfRegExp(/^[_:\w][_:\w-.\d]*/).toLowerCase()},t.prototype.tokenize=function(e){switch(this.kind){case u.WithinComment:if(e.advanceUntilString2("-->",!1))return{type:"comment.html.content"};if(e.advanceIfString2("-->"))return this.kind=u.Content,{type:"comment.html",bracket:r.Bracket.Close};break;case u.WithinDoctype:if(e.advanceUntilString2(">",!1))return{type:"meta.content.html"};if(e.advanceIfString2(">"))return this.kind=u.Content,{type:"meta.html",bracket:r.Bracket.Close};break;case u.Content:if(e.advanceIfCharCode2("<".charCodeAt(0))){if(!e.eos()&&"!"===e.peek()){if(e.advanceIfString2("!--"))return this.kind=u.WithinComment,{type:"comment.html",bracket:r.Bracket.Open};if(e.advanceIfStringCaseInsensitive2("!DOCTYPE"))return this.kind=u.WithinDoctype,{type:"meta.html",bracket:r.Bracket.Open}}return e.advanceIfCharCode2("/".charCodeAt(0))?(this.kind=u.OpeningEndTag,{type:"delimiter.end.html",bracket:r.Bracket.Open}):(this.kind=u.OpeningStartTag,{type:"delimiter.start.html",bracket:r.Bracket.Open})}break;case u.OpeningEndTag:var n=this.nextName(e);return n.length>0?{type:t.escapeTagName(n),bracket:-1!==d.indexOf(n)?-1:r.Bracket.Close}:e.advanceIfString2(">")?(this.kind=u.Content,{type:"delimiter.end.html",bracket:r.Bracket.Close}):(e.advanceUntilString2(">",!1),{type:""});case u.OpeningStartTag:if(this.lastTagName=this.nextName(e),this.lastTagName.length>0)return this.lastAttributeName=null,("script"===this.lastTagName||"style"===this.lastTagName)&&(this.lastAttributeName=null,this.embeddedContentType=null),this.kind=u.WithinTag,{type:t.escapeTagName(this.lastTagName),bracket:-1!==d.indexOf(this.lastTagName)?-1:r.Bracket.Open};break;case u.WithinTag:if(e.skipWhitespace2()||e.eos())return{type:""};var o=this.nextName(e);return o.length>0?(this.lastAttributeName=o,this.kind=u.AttributeName,{type:"attribute.name.html"}):e.advanceIfString2("/>")||e.advanceIfCharCode2(">".charCodeAt(0))?-1!==h.indexOf(this.lastTagName)?(this.kind=u.WithinEmbeddedContent,{type:"delimiter.start.html",bracket:r.Bracket.Close}):(this.kind=u.Content,{type:"delimiter.start.html",bracket:r.Bracket.Close}):(e.next2(),{type:""});case u.AttributeName:return e.skipWhitespace2()||e.eos()?{type:""}:e.advanceIfCharCode2("=".charCodeAt(0))?(this.kind=u.AttributeValue,{type:""}):(this.kind=u.WithinTag,this.tokenize(e));case u.AttributeValue:if(e.eos())return{type:""};if(e.skipWhitespace2())return'"'===this.attributeValueQuote||"'"===this.attributeValueQuote?{type:"attribute.value.html"}:{type:""};if('"'!==this.attributeValueQuote&&"'"!==this.attributeValueQuote){var s=e.peek();return"'"===s||'"'===s?(this.attributeValueQuote=s,this.attributeValue=s,e.next2(),{type:"attribute.value.html"}):(this.kind=u.WithinTag,this.tokenize(e))}if(this.attributeValue!==this.attributeValueQuote||"script"!==this.lastTagName&&"style"!==this.lastTagName||"type"!==this.lastAttributeName){if(e.advanceIfCharCode2(this.attributeValueQuote.charCodeAt(0)))this.kind=u.WithinTag,this.attributeValue="",this.attributeValueQuote="";else{var i=e.next();this.attributeValue+=i}return{type:"attribute.value.html"}}if(this.attributeValue=e.advanceUntilString(this.attributeValueQuote,!0),this.attributeValue.length>0)return this.embeddedContentType=this.unquote(this.attributeValue),this.kind=u.WithinTag,this.attributeValue="",this.attributeValueQuote="",{type:"attribute.value.html"}}return e.next2(),this.kind=u.Content,{type:""}},t.prototype.unquote=function(e){var t=0,r=e.length;return'"'===e[0]&&t++,'"'===e[r-1]&&r--,e.substring(t,r)},t}(n.AbstractState);t.State=m;var f=function(e){function t(t,r,n){var s=this;void 0===n&&(n=i.AsyncDescriptor.create("vs/languages/html/htmlWorker","HTMLWorker")),e.call(this,t,r,n),this.tokenizationSupport=new o.TokenizationSupport(this,!0),this.electricCharacterSupport=new o.BracketElectricCharacterSupport(this,{brackets:p,embeddedElectricCharacters:["*","}","]",")"]}),this.formattingSupport=this,this.extraInfoSupport=this,this.referenceSupport=new o.ReferenceSupport(this,{tokens:["invalid"],findReferences:function(e,t,r){return s.findReferences(e,t,r)}}),this.logicalSelectionSupport=this,this.parameterHintsSupport=new o.ParameterHintsSupport(this,{triggerCharacters:["(",","],excludeTokens:["*"],getParameterHints:function(e,t){return s.getParameterHints(e,t)}}),this.suggestSupport=new o.SuggestSupport(this,{triggerCharacters:["."," ",":"],excludeTokens:["*"],suggest:function(e,t){return s.suggest(e,t)}})}return __extends(t,e),t.prototype.asyncCtor=function(){var e=this;return a.Promise.join([v.getOrCreateMode("text/javascript"),v.getOrCreateMode("text/css")]).then(function(t){var r=e._getAutoClosingPairs(t);e.characterPairSupport=new o.CharacterPairSupport(e,{autoClosingPairs:r.slice(0),surroundingPairs:[{open:"<",close:">"},{open:'"',close:'"'},{open:"'",close:"'"}]})})},t.prototype.getNonWordTokenTypes=function(){return["delimiter.html"]},t.prototype._getAutoClosingPairs=function(e){var t=this,r={'"':'"',"'":"'"};e.forEach(function(e){return t._collectAutoClosingPairs(r,e)});var n,o=[];for(n in r)o.push({open:n,close:r[n]});return o},t.prototype._collectAutoClosingPairs=function(e,t){if(t&&t.characterPairSupport){var r=t.characterPairSupport.getAutoClosingPairs();if(null!==r)for(var n=0;n<r.length;n++)e[r[n].open]=r[n].close}},t.prototype.getInitialState=function(){return new m(this,u.Content,"","","","","")},t.prototype.enterNestedMode=function(e){return e instanceof m&&e.kind===u.WithinEmbeddedContent},t.prototype.getNestedMode=function(e){var t=null,r=e,n=null;if(null!==r.embeddedContentType)v.isRegisteredMode(r.embeddedContentType)&&(t=v.getMode(r.embeddedContentType),t||(n=v.getOrCreateMode(r.embeddedContentType)));else{var o=null;o="script"===r.lastTagName?"text/javascript":"style"===r.lastTagName?"text/css":"text/plain",t=v.getMode(o)}return null===t&&(t=v.getMode("text/plain")),{mode:t,missingModePromise:n}},t.prototype.getLeavingNestedModeData=function(e,t){var r=t.lastTagName,n=new RegExp("<\\/"+r+"\\s*>","i"),o=n.exec(e);return null!==o?{nestedModeBuffer:e.substring(0,o.index),bufferAfterNestedMode:e.substring(o.index),stateAfterNestedMode:new m(this,u.Content,"","","","","")}:null},t.prototype.getWordDefinition=function(){return t.WORD_DEFINITION},t.prototype.getCommentsConfiguration=function(){return{blockCommentStartToken:"<!--",blockCommentEndToken:"-->"}},t.prototype._worker=function(t){return e.prototype._worker.call(this,t)},t.prototype.formatDocument=function(e,t){return this._worker(function(r){return r.format(e,null,t)})},t.prototype.formatRange=function(e,t,r){return this._worker(function(n){return n.format(e,t,r)})},t.prototype.computeInfo=function(e,t){return this._delegateToModeAtPosition(e,t,function(e,r){return e&&r.getMode().extraInfoSupport?r.getMode().extraInfoSupport.computeInfo(r.getAssociatedResource(),t):void 0})},t.prototype.findReferences=function(e,t,r){return this._delegateToModeAtPosition(e,t,function(e,n){return e&&n.getMode().referenceSupport?n.getMode().referenceSupport.findReferences(n.getAssociatedResource(),t,r):void 0})},t.prototype.getRangesToPosition=function(e,t){return this._delegateToModeAtPosition(e,t,function(e,r){return e&&r.getMode().logicalSelectionSupport?r.getMode().logicalSelectionSupport.getRangesToPosition(r.getAssociatedResource(),t):void 0})},t.prototype.findDeclaration=function(e,t){return this._delegateToModeAtPosition(e,t,function(e,r){return e&&r.getMode().declarationSupport?r.getMode().declarationSupport.findDeclaration(r.getAssociatedResource(),t):void 0})},t.prototype.findOccurrences=function(e,t,r){var n=this;return void 0===r&&(r=!1),this._delegateToModeAtPosition(e,t,function(o,s){return o&&s.getMode().occurrencesSupport?s.getMode().occurrencesSupport.findOccurrences(s.getAssociatedResource(),t,r):n._worker(function(n){return n.findOccurrences(e,t,r)})})},t.prototype.suggest=function(e,t){var r=this;return this._delegateToModeAtPosition(e,t,function(n,o){return n&&o.getMode().suggestSupport?o.getMode().suggestSupport.suggest(o.getAssociatedResource(),t):r._worker(function(r){return r.suggest(e,t)})})},t.prototype.findColorDeclarations=function(e){return this._delegateToAllModes(e,function(e){var t=[];return t=e.filter(function(e){return"function"==typeof e.getMode().findColorDeclarations}).map(function(e){return e.getMode().findColorDeclarations(e.getAssociatedResource())}),a.TPromise.join(t).then(function(e){var t=[];return e.forEach(function(e){return t=t.concat(e)}),t})})},t.prototype.getParameterHints=function(e,t){return this._delegateToModeAtPosition(e,t,function(e,r){return e&&r.getMode().parameterHintsSupport?r.getMode().parameterHintsSupport.getParameterHints(r.getAssociatedResource(),t):void 0})},t.WORD_DEFINITION=n.createWordRegExp("#-?%"),t.$formatDocument=l.OneWorker(t,t.prototype.formatDocument),t.$formatRange=l.OneWorker(t,t.prototype.formatRange),t.$computeInfo=l.OneWorker(t,t.prototype.computeInfo),t.$findReferences=l.OneWorker(t,t.prototype.findReferences),t.$getRangesToPosition=l.OneWorker(t,t.prototype.getRangesToPosition),t.$findDeclaration=l.OneWorker(t,t.prototype.findDeclaration),t.$findOccurrences=l.OneWorker(t,t.prototype.findOccurrences),t.$suggest=l.OneWorker(t,t.prototype.suggest),t.$findColorDeclarations=l.OneWorker(t,t.prototype.findColorDeclarations),t.$getParameterHints=l.OneWorker(t,t.prototype.getParameterHints),t}(n.AbstractMode);t.HTMLMode=f;var v=s.Registry.as(n.Extensions.EditorModes)});